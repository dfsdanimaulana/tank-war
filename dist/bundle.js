(()=>{var e={41:()=>{Array.prototype.getRandomValue=function(){if(0!==this.length)return this[Math.floor(Math.random()*this.length)]}}},t={};function s(i){var h=t[i];if(void 0!==h)return h.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}(()=>{"use strict";class e{constructor(e){this.game=e,this.width=30,this.height=30,this.x=Math.random()*(this.game.width-this.width),this.y=Math.random()*(this.game.height-this.height),this.markedForDeletion=!1,this.drew=!1,this.angle=0,this.angleSpeed=.2,this.curve=.5,this.borderColor="orange"}checkCollision(){return this.game.checkCollision(this,this.game.player)}remove(){this.markedForDeletion=!0,this.game.bonusExpiredTimer=0,this.game.bonusTimer=0}update(){this.y+=this.curve*Math.sin(this.angle),this.angle+=this.angleSpeed}draw(e){this.drew||(this.checkCollision()&&(this.x=Math.random()*(this.game.width-this.width),this.y=Math.random()*(this.game.height-this.height)),this.drew=!0),this.drawBorder(e),e.save();const t=this.x+.5*this.width,s=this.y+.5*this.height,i=.5*this.width;e.save(),e.beginPath(),e.arc(t,s,i,0,2*Math.PI,!1),e.fillStyle=this.color,e.fill(),e.strokeStyle=this.color,e.stroke(),e.restore(),e.restore()}drawBorder(e){const t=this.x+.5*this.width,s=this.y+.5*this.height,i=.8*this.width,h=this.borderColor;e.save(),e.beginPath(),e.arc(t,s,i,0,2*Math.PI),e.lineWidth=2,e.strokeStyle=h,e.stroke(),e.restore()}}class t extends e{constructor(e){super(e),this.color="red"}update(){super.update(),this.checkCollision()&&(this.game.player.weaponLevel<this.game.player.maxWeaponLevel-1&&this.game.player.weaponLevel++,this.remove())}}class i extends e{constructor(e){super(e),this.color="yellow"}update(){super.update(),this.checkCollision()&&(this.game.player.shield=!0,this.remove())}}class h extends e{constructor(e){super(e),this.color="blue"}update(){super.update(),this.checkCollision()&&(this.game.player.lives<this.game.player.maxLives&&!this.game.gameOver&&this.game.player.lives++,this.remove())}}class r extends e{constructor(e){super(e),this.color="white"}update(){super.update(),this.checkCollision()&&(this.game.player.weaponLevel=5,this.game.player.rocketInterval=1e4,this.remove())}}function a(e,t,s){let i=null,h=Number.MAX_VALUE;for(const r of e){const e=Math.sqrt((t-r.x)**2+(s-r.y)**2);e<h&&(h=e,i=r)}return i}function o(e,t){return Math.floor(Math.random()*(t-e+1))+e}class n{constructor(e){this.game=e,this.width=10,this.height=10,this.x=0,this.y=0,this.speedX=0,this.speedY=0,this.maxSpeed=10,this.free=!0,this.onAir=!1}update(){(this.y<-this.height||this.y>this.game.height||this.x<-this.width||this.x>this.game.width)&&this.reset(),this.x+=this.speedX,this.y+=this.speedY}draw(e){if(!this.free){const t=this.x+.5*this.width,s=this.y+.5*this.height,i=.5*this.width;e.save(),e.beginPath(),e.arc(t,s,i,0,2*Math.PI,!1),e.fillStyle=this.color,e.fill(),e.strokeStyle=this.color,e.stroke(),e.restore()}}start(e,t){this.x=e-.5*this.width,this.y=t-.5*this.height,this.free=!1}reset(){this.free=!0,this.onAir=!1,this.speedX=0,this.speedY=0}updateDirection(e){switch(e){case"right":this.speedX=this.maxSpeed;break;case"left":this.speedX=-this.maxSpeed;break;case"up":this.speedY=-this.maxSpeed;break;case"down":this.speedY=this.maxSpeed;break;default:this.speedX=0,this.speedY=0}}}class d extends n{constructor(e){super(e),this.color="red",this.damage=1}update(){super.update(),!this.free&&this.game.checkCollision(this,this.game.player)&&(this.game.player.shield?this.game.player.shield=!1:this.game.player.lives--,this.reset())}}class l extends d{constructor(e){super(e)}update(e){super.update(),this.free||this.onAir||(this.updateDirection(e.direction),this.onAir=!0)}}class p extends d{constructor(e){super(e)}update(e){if(super.update(),!this.free&&!this.onAir){const t=e.weapon.degreeModifier*e.weapon.degree,s=t>=360?t-360:t;s>=22.5&&s<67.5?(this.speedX=this.maxSpeed,this.speedY=-this.maxSpeed):s>=67.5&&s<112.5?(this.speedX=this.maxSpeed,this.speedY=0):s>=112.5&&s<157.5?(this.speedX=this.maxSpeed,this.speedY=this.maxSpeed):s>=157.5&&s<202.5?(this.speedX=0,this.speedY=this.maxSpeed):s>=202.5&&s<247.5?(this.speedX=-this.maxSpeed,this.speedY=this.maxSpeed):s>=247.5&&s<292.5?(this.speedX=-this.maxSpeed,this.speedY=0):s>=292.5&&s<337.5?(this.speedX=-this.maxSpeed,this.speedY=-this.maxSpeed):(this.speedX=0,this.speedY=-this.maxSpeed),this.onAir=!0}}}class m extends d{constructor(e){super(e)}update(){if(super.update(),!this.free){const e=this.x-this.game.player.x,t=this.y-this.game.player.y,s=Math.sqrt(e**2+t**2);this.x+=e/s*this.maxSpeed,this.y+=t/s*this.maxSpeed}}}class c{constructor(){this.fps=20,this.frameTimer=0,this.frameInterval=1e3/this.fps}update(e){this.frameTimer>this.frameInterval?(this.frameX<this.maxFrame?this.frameX++:this.frameX=0,this.frameTimer=0):this.frameTimer+=e,this.x<0&&(this.x=0),this.x>this.game.width-this.width&&(this.x=this.game.width-this.width),this.y<0&&(this.y=0),this.y>this.game.height-this.height&&(this.y=this.game.height-this.height),this.x+=this.speedX,this.y+=this.speedY}moveUp(){this.direction="up",this.speedY=-this.maxSpeed,this.speedX=0,this.degree=0}moveDown(){this.direction="down",this.speedY=this.maxSpeed,this.speedX=0,this.degree=180}moveLeft(){this.direction="left",this.speedX=-this.maxSpeed,this.speedY=0,this.degree=270}moveRight(){this.direction="right",this.speedX=this.maxSpeed,this.speedY=0,this.degree=90}moveUpLeft(){this.direction="up-left",this.speedX=-this.maxSpeed,this.speedY=-this.maxSpeed,this.degree=315}moveUpRight(){this.direction="up-right",this.speedX=this.maxSpeed,this.speedY=-this.maxSpeed,this.degree=45}moveDownLeft(){this.direction="down-left",this.speedX=-this.maxSpeed,this.speedY=this.maxSpeed,this.degree=225}moveDownRight(){this.direction="down-right",this.speedX=this.maxSpeed,this.speedY=this.maxSpeed,this.degree=135}draw(e){if(this.game.stroke){e.save(),e.strokeStyle="yellow",e.lineWidth=2;const t=this.width/2;e.beginPath(),e.arc(this.x+this.width/2,this.y+this.height/2,t,0,2*Math.PI),e.stroke(),e.restore(),e.save(),e.strokeStyle="white",e.setLineDash([5,5]),e.strokeRect(this.x,this.y,this.width,this.height),e.restore()}e.save(),e.translate(this.x+.5*this.width,this.y+.5*this.height),e.rotate(this.degree*Math.PI/180),e.drawImage(this.image,this.frameX*this.spriteWidth,this.frameY*this.spriteHeight,this.spriteWidth,this.spriteHeight,.5*-this.width,.5*-this.height,this.width,this.height),e.restore(),e.save(),e.fillStyle=this.liveBarColor,e.strokeStyle=this.liveBarColor;const t=20*this.maxLives,s=.5*this.width-.5*t;for(let t=0;t<this.maxLives;t++)e.strokeRect(this.x+20*t+s,this.y,15,7);for(let t=0;t<this.lives;t++)e.fillRect(this.x+20*t+s,this.y,15,7);e.restore()}}s(41);class g{constructor(){this.fps=20,this.frameTimer=0,this.frameInterval=1e3/this.fps,this.active=!1}update(e){this.active&&(this.frameTimer>this.frameInterval?(this.frameX<this.maxFrame?this.frameX++:(this.frameX=0,this.active=!1),this.frameTimer=0):this.frameTimer+=e)}}class u extends g{constructor(e){super(),this.enemy=e,this.spriteWidth=128,this.spriteHeight=128,this.frameX=0,this.frameY=0,this.maxFrame=7,this.width=this.spriteWidth*this.enemy.scale,this.height=this.spriteHeight*this.enemy.scale,this.degree=360*Math.random(),this.initialDegree=this.degree,this.degreeModifier=0,this.maxDegreeModifier=10,this.parentDegreeModifier=1,this.fps=5,this.timer=0,this.timerInterval=1e3/this.fps}draw(e){e.save(),e.translate(this.enemy.x+.5*this.width,this.enemy.y+.5*this.height),e.rotate((this.enemy.degree*this.parentDegreeModifier+this.degree*this.degreeModifier)*Math.PI/180),e.drawImage(this.image,this.frameX*this.spriteWidth,this.frameY*this.spriteHeight,this.spriteWidth,this.spriteHeight,.5*-this.width,.5*-this.height,this.width,this.height),e.restore()}}class w extends u{constructor(e){super(e),this.type="NormalWeapon"}}class y extends u{constructor(e){super(e),this.type="MovingWeapon",this.rotateSpeed=.02*Math.random()+.01,this.degreeModifier=1,this.parentDegreeModifier=0}update(e){this.timer>this.timerInterval?(this.degreeModifier*this.degree>360+this.degree?(this.degree=this.initialDegree,this.degreeModifier=1):this.degreeModifier+=this.rotateSpeed,this.timer=0):this.timer+=e}}class x extends w{constructor(e){super(e),this.images=[enemyWeaponRed1_1,enemyWeaponPurple1_1,enemyWeaponGreen1_1,enemyWeaponDesert1_1],this.image=this.images.getRandomValue()}}class f extends w{constructor(e){super(e),this.images=[enemyWeaponRed1_2,enemyWeaponPurple1_2,enemyWeaponGreen1_2,enemyWeaponDesert1_2],this.image=this.images.getRandomValue()}}class v extends w{constructor(e){super(e),this.images=[enemyWeaponRed1_3,enemyWeaponPurple1_3,enemyWeaponGreen1_3,enemyWeaponDesert1_3],this.image=this.images.getRandomValue()}}class k extends w{constructor(e){super(e),this.images=[enemyWeaponRed1_4,enemyWeaponPurple1_4,enemyWeaponGreen1_4,enemyWeaponDesert1_4],this.image=this.images.getRandomValue()}}class S extends y{constructor(e){super(e),this.images=[enemyWeaponRed2_1,enemyWeaponPurple2_1,enemyWeaponGreen2_1,enemyWeaponDesert2_1],this.image=this.images.getRandomValue(),this.maxFrame=10}}class T extends y{constructor(e){super(e),this.images=[enemyWeaponRed2_2,enemyWeaponPurple2_2,enemyWeaponGreen2_2,enemyWeaponDesert2_2],this.image=this.images.getRandomValue(),this.maxFrame=10}}class X extends y{constructor(e){super(e),this.images=[enemyWeaponRed2_3,enemyWeaponPurple2_3,enemyWeaponGreen2_3,enemyWeaponDesert2_3],this.image=this.images.getRandomValue(),this.maxFrame=10}}class b extends y{constructor(e){super(e),this.images=[enemyWeaponRed2_4,enemyWeaponPurple2_4,enemyWeaponGreen2_4,enemyWeaponDesert2_4],this.image=this.images.getRandomValue(),this.maxFrame=10}}class P extends c{constructor(e){super(),this.game=e,this.images=[enemyBodyRed,enemyBodyGreen,enemyBodyPurple,enemyBodyDesert],this.image=this.images.getRandomValue(),this.scale=this.game.scale,this.spriteWidth=128,this.spriteHeight=128,this.frameX=0,this.frameY=0,this.maxFrame=1,this.lives=o(2,4),this.maxLives=this.lives,this.drew=!1,this.inFrame=!1,this.inFrameGap=10,this.width=this.spriteWidth*this.scale,this.height=this.spriteHeight*this.scale,this.x=Math.random()*(this.game.width-this.width),this.y=Math.random()*(this.game.height-this.height),this.maxSpeed=.5*Math.random()+1,this.speedX=0,this.speedY=0,this.markedForDeletion=!1,this.degree=0,this.direction="up",this.liveBarColor="red",this.weapons=[new x(this),new f(this),new v(this),new k(this),new S(this),new T(this),new X(this),new b(this)],this.weapon=this.weapons.getRandomValue(),this.projectilesPool=[],this.numberOfProjectiles=1,this.createProjectiles(),this.directionTimer=0,this.changeDirectionInterval=o(1e3,4e3),this.nextShootTimer=0,this.nextShootInterval=o(1e3,2500)}createProjectiles(){for(let e=0;e<this.numberOfProjectiles;e++)"NormalWeapon"===this.weapon.type?this.projectilesPool.push(new l(this.game)):"MovingWeapon"===this.weapon.type?this.projectilesPool.push(new p(this.game)):"RocketWeapon"===this.weapon.type&&this.projectilesPool.push(new m(this.game))}getProjectile(){for(let e=0;e<this.projectilesPool.length;e++)if(this.projectilesPool[e].free)return this.projectilesPool[e]}shoot(){const e=this.getProjectile();e&&(this.weapon.active=!0,e.start(this.x+.5*this.width,this.y+.5*this.height))}update(e){super.update(e),this.shootProjectile(e),this.weapon.update(e),this.randomMovement(e),this.setEnemyBoundaries(),this.createExplosion(),this.handleCollisions(),this.projectilesPool.forEach((e=>e.update(this))),this.x+=this.speedX*this.maxSpeed,this.y+=this.speedY*this.maxSpeed}draw(e){this.drew=!0,this.projectilesPool.forEach((t=>t.draw(e))),super.draw(e),this.weapon.draw(e)}shootProjectile(e){this.nextShootTimer>this.nextShootInterval?(this.shoot(),this.nextShootTimer=0):this.nextShootTimer+=e}randomMovement(e){if(this.directionTimer>this.changeDirectionInterval||!this.drew){const e=["up","down","left","right"];switch(this.direction=e.getRandomValue(),this.direction){case"up":this.moveUp();break;case"down":this.moveDown();break;case"left":this.moveLeft();break;case"right":this.moveRight()}this.directionTimer=0}else this.directionTimer+=e}createExplosion(){this.lives<1&&(this.game.createExplosion(this.x,this.y,this.width),this.markedForDeletion=!0,this.game.gameOver||this.game.score++)}setEnemyBoundaries(){(this.x<0||this.x>this.game.width-this.width)&&(this.speedX*=-1),(this.y<0||this.y>this.game.height-this.height)&&(this.speedY*=-1)}handleCollisions(){this.game.player.projectilesPool.forEach((e=>{!e.free&&this.game.checkCollision(this,e)&&(this.lives-=e.damage,e.reset())})),this.game.enemies.forEach((e=>{this.x!==e.x&&this.y!==e.y&&this.game.checkCircleCollision(this,e)&&this.game.resolveCollision(this,e)})),this.game.checkCircleCollision(this,this.game.player)&&(this.lives=0,this.game.player.shield?this.game.player.shield=!1:(this.game.player.lives-=1,this.game.player.weaponLevel=0))}}class W{constructor(){this.keys=[],this.swipeStartX=0,this.swipeStartY=0,this.swipeEndX=0,this.swipeEndY=0,this.previousSwipeDirection="",this.touchStartTime=0,this.touchEndTime=0,this.holdTimer=0,this.holdThreshold=500,window.addEventListener("keydown",(e=>{-1===this.keys.indexOf(e.key)&&this.keys.push(e.key)})),window.addEventListener("keyup",(e=>{const t=this.keys.indexOf(e.key);t>-1&&this.keys.splice(t,1)})),window.addEventListener("touchstart",(e=>{this.swipeStartX=e.touches[0].clientX,this.swipeStartY=e.touches[0].clientY,this.onTouchStart()})),window.addEventListener("touchmove",(e=>{this.swipeEndX=e.changedTouches[0].clientX,this.swipeEndY=e.changedTouches[0].clientY,this.handleSwipe()})),window.addEventListener("touchend",(e=>{this.getReleasedSwipeDirection(),this.onTouchEnd()}))}enterState(){-1===this.keys.indexOf("Enter")&&this.keys.push("Enter"),this.previousSwipeDirection="enter"}onTouchStart(){this.touchStartTime=(new Date).getTime(),this.holdTimer=setTimeout((()=>this.enterState()),this.holdThreshold)}onTouchEnd(){this.touchEndTime=(new Date).getTime(),this.touchEndTime,this.touchStartTime,clearTimeout(this.holdTimer),this.holdThreshold}handleSwipe(){const e=this.swipeEndX-this.swipeStartX,t=this.swipeEndY-this.swipeStartY;Math.abs(e)>Math.abs(t)?e>0?(-1===this.keys.indexOf("ArrowRight")&&this.keys.push("ArrowRight"),this.previousSwipeDirection="right"):(-1===this.keys.indexOf("ArrowLeft")&&this.keys.push("ArrowLeft"),this.previousSwipeDirection="left"):t>0?(-1===this.keys.indexOf("ArrowDown")&&this.keys.push("ArrowDown"),this.previousSwipeDirection="down"):(-1===this.keys.indexOf("ArrowUp")&&this.keys.push("ArrowUp"),this.previousSwipeDirection="up")}getReleasedSwipeDirection(){switch(this.previousSwipeDirection){case"up":this.keys.splice(this.keys.indexOf("ArrowUp"),1);break;case"down":this.keys.splice(this.keys.indexOf("ArrowDown"),1);break;case"right":this.keys.splice(this.keys.indexOf("ArrowRight"),1);break;case"left":this.keys.splice(this.keys.indexOf("ArrowLeft"),1);break;default:this.keys.splice(this.keys.indexOf("Enter"),1)}}}class D{constructor(e,t,s){this.x=e,this.y=t,this.size=s,this.spriteWidth=200,this.spriteHight=179,this.image=boom,this.frameX=0,this.timeSinceLastFrame=0,this.frameXInterval=200,this.markedForDeletion=!1}update(e){this.timeSinceLastFrame+=e,this.timeSinceLastFrame>this.frameXInterval&&(this.frameX++,this.timeSinceLastFrame=0,this.frameX>5&&(this.markedForDeletion=!0))}draw(e){e.drawImage(this.image,this.frameX*this.spriteWidth,0,this.spriteWidth,this.spriteHight,this.x,this.y-this.size/4,this.size,this.size)}}class E extends n{constructor(e){super(e),this.color="gold",this.damage=1}}class M extends E{constructor(e){super(e),this.type="NormalProjectile"}update(){super.update(),this.free||this.onAir||(this.updateDirection(this.game.player.direction),this.onAir=!0)}}class Y extends E{constructor(e){super(e),this.type="RocketProjectile"}update(){if(super.update(),this.game.enemies.length>0&&!this.free){this.onAir||(this.onAir=!0);const e=a(this.game.enemies,this.x,this.y),t=e.x+.5*e.width,s=e.y+.5*e.height,i=t-(this.x+.5*this.width),h=s-(this.y+.5*this.height),r=Math.sqrt(i**2+h**2);this.x+=i/r*this.maxSpeed,this.y+=h/r*this.maxSpeed}}}class I extends g{constructor(e){super(),this.game=e,this.spriteWidth=128,this.spriteHeight=128,this.frameX=0,this.frameY=0,this.maxFrame=7,this.width=this.spriteWidth*this.game.scale,this.height=this.spriteHeight*this.game.scale,this.degree=0,this.initialDegree=this.degree,this.degreeModifier=0,this.parentDegreeModifier=1}draw(e){e.save(),e.translate(this.game.player.x+.5*this.width,this.game.player.y+.5*this.height),e.rotate((this.game.player.degree*this.parentDegreeModifier+this.degree*this.degreeModifier)*Math.PI/180),e.drawImage(this.image,this.frameX*this.spriteWidth,this.frameY*this.spriteHeight,this.spriteWidth,this.spriteHeight,.5*-this.width,.5*-this.height,this.width,this.height),e.restore()}}class R extends I{constructor(e){super(e),this.type="NormalWeapon"}}class _ extends I{constructor(e){super(e),this.type="RocketWeapon",this.degreeModifier=1,this.parentDegreeModifier=0}update(e){super.update(e);const t=this.game.player.x,s=this.game.player.y;if(this.game.enemies.length>0){const e=a(this.game.enemies,t,s),i=function(e,t,s,i){let h=Math.atan2(i-t,s-e)*(180/Math.PI)+90;return h<0&&(h+=360),h}(t,s,e.x,e.y);this.degree=i}}}class j extends R{constructor(e){super(e),this.image=playerWeaponBlue1_1}}class C extends R{constructor(e){super(e),this.image=playerWeaponBlue1_2}}class A extends R{constructor(e){super(e),this.image=playerWeaponBlue1_3}}class B extends R{constructor(e){super(e),this.image=playerWeaponBlue2_1,this.maxFrame=10}}class L extends R{constructor(e){super(e),this.image=playerWeaponBlue2_2,this.maxFrame=10}}class F extends _{constructor(e){super(e),this.image=playerWeaponBlue2_3,this.maxFrame=10}}class O extends c{constructor(e){super(),this.game=e,this.image=playerBodyBlue,this.scale=this.game.scale,this.spriteWidth=128,this.spriteHeight=128,this.degree=0,this.frameX=0,this.frameY=0,this.maxFrame=1,this.width=this.spriteWidth*this.scale,this.height=this.spriteHeight*this.scale,this.x=.5*this.game.width-.5*this.width,this.y=.5*this.game.height-.5*this.height,this.weapons=[new j(this.game),new C(this.game),new A(this.game),new B(this.game),new L(this.game),new F(this.game)],this.weaponLevel=0,this.maxWeaponLevel=this.weapons.length,this.weapon=this.weapons[this.weaponLevel],this.projectilesPool=[],this.numberOfProjectiles=1,this.createProjectiles(),this.speedX=0,this.speedY=0,this.maxSpeed=5,this.direction="up",this.lives=5,this.maxLives=this.lives,this.liveBarColor="blue",this.upgradeWeapon=!1,this.shield=!1,this.rocketTimer=0,this.rocketInterval=0}restart(){this.x=.5*this.game.width-.5*this.width,this.y=.5*this.game.height-.5*this.height,this.speedX=0,this.speedY=0,this.direction="up",this.lives=5,this.rocketTimer=0,this.weaponLevel=0}update(e){super.update(e),this.shootProjectile(),this.handleMovement(),this.handleRocketTimer(e),this.weapon=this.weapons[this.weaponLevel],this.projectilesPool.forEach((t=>{t.update(e)})),this.weapon.update(e)}draw(e){this.drawLines(e),super.draw(e),this.projectilesPool.forEach((t=>{t.draw(e)})),this.weapon.draw(e),this.shield&&this.drawShield(e)}shootProjectile(){(this.game.input.keys.includes("Enter")||this.game.input.keys.includes(" "))&&this.shoot()}createProjectiles(){for(let e=0;e<this.numberOfProjectiles;e++)this.projectilesPool.push(new M(this.game),new Y(this.game))}getProjectile(){return"RocketWeapon"===this.weapon.type?this.getRocketProjectile():"NormalWeapon"===this.weapon.type?this.getNormalProjectile():void 0}getRocketProjectile(){for(let e=0;e<this.projectilesPool.length;e++)if(this.projectilesPool[e].free&&"RocketProjectile"===this.projectilesPool[e].type)return this.projectilesPool[e]}getNormalProjectile(){for(let e=0;e<this.projectilesPool.length;e++)if(this.projectilesPool[e].free&&"NormalProjectile"===this.projectilesPool[e].type)return this.projectilesPool[e]}shoot(){const e=this.getProjectile();e&&(this.weapon.active=!0,e.start(this.x+.5*this.width,this.y+.5*this.height))}handleRocketTimer(e){this.rocketInterval>0?this.rocketTimer>this.rocketInterval?(this.weaponLevel=0,this.rocketTimer=0,this.rocketInterval=0):this.rocketTimer+=e:this.rocketTimer=0}handleMovement(){this.game.input.keys.includes("ArrowRight")||this.game.input.keys.includes("d")?this.moveRight():this.game.input.keys.includes("ArrowLeft")||this.game.input.keys.includes("a")?this.moveLeft():this.game.input.keys.includes("ArrowDown")||this.game.input.keys.includes("s")?this.moveDown():this.game.input.keys.includes("ArrowUp")||this.game.input.keys.includes("w")?this.moveUp():(this.speedY=0,this.speedX=0),this.game.input.keys.includes("Control")||this.game.input.keys.includes("c")?this.maxSpeed=10:this.maxSpeed=5}drawShield(e){e.save(),function(e,t,s,i,h=1){e.save();const r=t+.5*i,a=s+.5*i,o=i*h,n=e.createRadialGradient(r,a,0,r,a,o);n.addColorStop(1,"rgba(170, 255, 0, 0.1)"),n.addColorStop(0,"rgba(170, 255, 0, 0.3)"),e.fillStyle=n,e.beginPath(),e.arc(r,a,o,0,2*Math.PI,!1),e.fill(),e.lineWidth=2,e.stroke(),e.restore()}(e,this.x,this.y,this.width,.75),e.lineWidth=2;const t=.75*this.width;e.strokeStyle="lightgreen",e.beginPath(),e.arc(this.x+this.width/2,this.y+this.height/2,t,0,2*Math.PI),e.stroke(),e.restore()}drawLines(e){this.game.stroke&&(e.save(),e.strokeStyle="blue",this.game.enemies.map((t=>{!function(e,t,s,i,h){e.beginPath(),e.moveTo(t,s),e.lineTo(i,h),e.stroke()}(e,this.x+this.width/2,this.y+this.height/2,t.x+t.width/2,t.y+t.height/2)})),e.restore())}}class H{constructor(e,t,s,i,h){this.game=e,this.image=terrainImage,this.width=128,this.height=128,this.x=t,this.y=s,this.degree=i,this.type=h,this.frameY=this.type}checkTerrainCollision(e){return this.game.checkCircleCollision(this,e)}randomDegree(){const e=[0,90,180,270];this.degree=e[Math.floor(Math.random()*e.length)]}update(){}draw(e){e.save(),e.translate(this.x+.5*this.width,this.y+.5*this.height),e.rotate(this.degree*Math.PI/180),e.drawImage(this.image,this.frameX*this.width,this.frameY*this.height,this.width,this.height,.5*-this.width,.5*-this.height,this.width,this.height),e.restore(),this.game.stroke&&(e.save(),e.strokeStyle="white",e.setLineDash([5,5]),e.strokeRect(this.x,this.y,this.width,this.height),e.restore())}}class z extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=0}}class V extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=1,this.randomDegree()}}class G extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=2,this.getHit=!1,this.growTimer=0,this.growInterval=1e4,this.randomDegree()}update(e){super.update(),this.getHit&&(this.growTimer>this.growInterval?(this.getHit=!1,this.growTimer=0):this.growTimer+=e),this.checkTerrainCollision(this.game.player)&&(this.getHit=!0),this.game.enemies.forEach((e=>{this.checkTerrainCollision(e)&&(this.getHit=!0)})),this.getHit?this.frameX=1:this.frameX=2}}class U extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=3}}class N extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=4}}class q extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=5}}class J extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=6}}class K extends H{constructor(e,t,s,i,h){super(e,t,s,i,h),this.images=[towers_walls_snow,towers_walls_grass_light_1,towers_walls_grass_light_2,towers_walls_grass_dark_1,towers_walls_grass_dark_2],this.image=this.images[this.type]}resolveCollisionWithWall(e){(e.speedX>0&&e.x+e.width>this.x||e.speedX<0&&e.x<this.x+this.width)&&(e.speedX=-e.speedX),(e.speedY>0&&e.y+e.height>this.y||e.speedY<0&&e.y<this.y+this.height)&&(e.speedY=-e.speedY)}update(e){super.update(e),this.game.checkCircleCollision(this,this.game.player)&&(this.game.player=this.game.bounceObject(this.game.player)),this.game.enemies.forEach((e=>{this.game.checkCircleCollision(this,e)&&(e.drew||(e.x=Math.random()*(this.game.width-e.width),e.y=Math.random()*(this.game.height-e.height)),this.resolveCollisionWithWall(e))})),this.game.enemies.forEach((e=>{e.projectilesPool.forEach((e=>{this.game.checkCollision(this,e)&&e.reset()}))})),this.game.player.projectilesPool.forEach((e=>{this.game.checkCollision(this,e)&&e.reset()}))}}class Q extends K{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameY=4}}class Z extends K{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameY=3}}class $ extends Q{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=1}}class ee extends Q{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=2}}class te extends Q{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=4}}class se extends Q{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=5}}class ie extends Q{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=0}}class he extends Q{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=3}}class re extends Z{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=1}}class ae extends Z{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=2}}class oe extends Z{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=4}}class ne extends Z{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=5}}class de extends Z{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=0}}class le extends Z{constructor(e,t,s,i,h){super(e,t,s,i,h),this.frameX=3}}class pe{constructor(e){this.game=e,this.terrainSize=128,this.gridSize=10,this.type=0,this.map=[],this.terrainClasses=[z,V,G,U,N,q,J,$,ee,te,se,ie,re,ae,oe,ne,de,he,le]}generateTerrain(){for(let e=0;e<this.terrainPattern.length;e++){this.map[e]=[];for(let t=0;t<this.terrainPattern[e].length;t++){const s=this.terrainPattern[t][e];Array.isArray(s)?this.map[e][t]=new this.terrainClasses[s[0]](this.game,e*this.terrainSize,t*this.terrainSize,s[1],this.type):this.map[e][t]=new this.terrainClasses[s](this.game,e*this.terrainSize,t*this.terrainSize,0,this.type)}}}update(e){for(let t=0;t<this.gridSize;t++)for(let s=0;s<this.gridSize;s++)this.map[t][s].update(e)}draw(e){for(let t=0;t<this.gridSize;t++)for(let s=0;s<this.gridSize;s++)this.map[t][s].draw(e)}}class me extends pe{constructor(e){super(e),this.type=0,this.terrainPattern=[[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]],[[2,0],[17,270],[8,0],[8,0],[8,0],[8,0],[8,0],[17,0],[2,0],[2,0]],[[2,0],[8,90],[16,0],[0,0],[0,0],[0,0],[16,0],[7,270],[2,0],[2,0]],[[2,0],[8,90],[0,0],[0,0],[4,0],[3,90],[3,90],[3,90],[5,90],[3,90]],[[2,0],[8,90],[0,0],[0,0],[3,0],[0,0],[0,0],[7,90],[3,0],[2,0]],[[2,0],[18,180],[8,0],[7,180],[3,0],[7,0],[8,0],[18,90],[3,0],[2,0]],[[2,0],[0,0],[0,0],[1,0],[3,0],[0,0],[0,0],[1,0],[3,0],[0,0]],[[2,0],[2,0],[0,0],[0,0],[3,0],[0,0],[0,0],[0,0],[3,0],[0,0]],[[2,0],[0,0],[0,0],[0,0],[3,0],[0,0],[0,0],[0,0],[3,0],[2,0]],[[3,90],[3,90],[3,90],[3,90],[6,0],[3,90],[3,90],[3,90],[5,270],[3,90]]],this.generateTerrain()}}class ce extends pe{constructor(e){super(e),this.type=1,this.terrainPattern=[[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]],[[2,0],[0,0],[17,270],[8,0],[8,0],[8,0],[8,0],[8,0],[17,0],[2,0]],[[2,0],[2,0],[7,270],[0,0],[0,0],[0,0],[0,0],[16,0],[8,270],[2,0]],[[3,90],[5,90],[3,90],[3,90],[4,90],[0,0],[0,0],[0,0],[8,270],[2,0]],[[2,0],[3,0],[7,90],[0,0],[3,0],[0,0],[0,0],[0,0],[8,90],[2,0]],[[2,0],[3,0],[18,180],[7,180],[3,0],[7,0],[8,0],[8,0],[18,90],[2,0]],[[2,0],[3,0],[1,0],[0,0],[3,0],[0,0],[0,0],[0,0],[2,0],[2,0]],[[2,0],[3,0],[0,0],[0,0],[3,0],[0,0],[0,0],[0,0],[2,0],[2,0]],[[2,0],[3,0],[0,0],[0,0],[3,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[3,90],[5,270],[3,90],[3,90],[6,90],[3,90],[3,90],[3,90],[3,90],[3,90]]],this.generateTerrain()}}class ge extends pe{constructor(e){super(e),this.type=2,this.terrainPattern=[[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[0,0],[18,270],[7,180],[0,0],[0,0],[7,0],[18,0],[0,0],[2,0]],[[2,0],[0,0],[7,270],[0,0],[0,0],[0,0],[0,0],[7,270],[0,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[0,0],[7,90],[0,0],[0,0],[0,0],[0,0],[7,90],[0,0],[2,0]],[[2,0],[0,0],[18,180],[7,180],[0,0],[0,0],[7,0],[18,90],[0,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]]],this.generateTerrain()}}class ue extends pe{constructor(e){super(e),this.type=3,this.terrainPattern=[[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]],[[2,0],[4,0],[3,90],[3,90],[3,90],[3,90],[3,90],[3,90],[4,90],[2,0]],[[2,0],[3,0],[18,270],[7,180],[0,0],[0,0],[7,0],[18,0],[3,0],[2,0]],[[2,0],[3,0],[7,270],[1,0],[0,0],[0,0],[0,0],[7,270],[3,0],[2,0]],[[2,0],[3,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[3,0],[2,0]],[[2,0],[3,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[3,0],[2,0]],[[2,0],[3,0],[7,90],[0,0],[0,0],[0,0],[0,0],[7,90],[3,0],[2,0]],[[2,0],[3,0],[18,180],[7,180],[0,0],[0,0],[7,0],[18,90],[3,0],[2,0]],[[2,0],[4,270],[3,90],[3,90],[3,90],[3,90],[3,90],[3,90],[4,180],[2,0]],[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]]],this.generateTerrain()}}class we extends pe{constructor(e){super(e),this.type=4,this.terrainPattern=[[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[0,0],[18,270],[7,180],[0,0],[0,0],[7,0],[18,0],[0,0],[2,0]],[[2,0],[0,0],[7,270],[0,0],[0,0],[0,0],[0,0],[7,270],[0,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[0,0],[7,90],[0,0],[0,0],[0,0],[0,0],[7,90],[0,0],[2,0]],[[2,0],[0,0],[18,180],[7,180],[0,0],[0,0],[7,0],[18,90],[0,0],[2,0]],[[2,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0]],[[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0],[2,0]]],this.generateTerrain()}}class ye{constructor(e){this.game=e,this.fromX=10,this.fromY=30,this.fontSize=30,this.fontFamily="Creepster",this.fontColor="white"}drawSquare(e){e.save(),e.beginPath(),e.moveTo(12,2),e.lineTo(237,2),e.arcTo(247,2,247,12,10),e.lineTo(247,212),e.arcTo(247,222,237,222,10),e.lineTo(12,222),e.arcTo(2,222,2,212,10),e.lineTo(2,12),e.arcTo(2,2,12,2,10),e.closePath(),e.lineWidth=2,e.strokeStyle="black",e.fillStyle="rgba(0, 0, 0, 0.2)",e.stroke(),e.fill(),e.restore()}draw(e){this.drawSquare(e),e.save(),e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowColor="black",e.shadowBlur=0,e.font=this.fontSize+"px "+this.fontFamily,e.textAlign="left",e.fillStyle=this.fontColor,e.fillText("Score: "+this.game.score,this.fromX,1*this.fromY),e.fillText("Best Score: "+this.game.bestScore,this.fromX,2.5*this.fromY),e.fillText("Wave: "+this.game.wave,this.fromX,4*this.fromY),this.game.bonusTimer>0&&e.fillText("Next Bonus In: "+(.001*this.game.bonusInterval-(.001*this.game.bonusTimer).toFixed()),this.fromX,5.5*this.fromY),this.game.bonusExpiredTimer>0&&e.fillText("Bonus Expired In: "+(.001*this.game.bonusExpiredInterval-(.001*this.game.bonusExpiredTimer).toFixed()),this.fromX,5.5*this.fromY),this.game.input.keys.forEach(((t,s)=>{" "===t&&(t="Space"),e.fillText(t,this.fromX,7*this.fromY+25*s)})),this.game.gameOver&&(e.save(),e.textAlign="center",e.font="150px "+this.fontFamily,e.fillText("GAME OVER",.5*this.game.width,.5*this.game.height),e.font="30px Impact",e.fillText("press R or SwipeDown to restart",.5*this.game.width,.5*this.game.height+35),e.restore()),e.restore()}}class xe{constructor(e,t){this.width=e,this.height=t,this.scale=1,this.initialize()}initialize(){this.player=new O(this),this.input=new W,this.UI=new ye(this),this.terrainsType=[new me(this),new ce(this),new ge(this),new ue(this),new we(this)],this.terrains=this.getRandomTerrain(),this.enemies=[],this.maxEnemies=3,this.collisions=[],this.score=0,this.bestScore=this.getBestScore(),this.checkBestScore(),this.wave=0,this.gameOver=!1,this.bonuses=[],this.bonusTimer=0,this.bonusExpiredTimer=0,this.bonusInterval=15e3,this.bonusExpiredInterval=1e4,this.stroke=!1}update(){this.handleDebugMode(),this.handleRestartGame(),this.handleLoseCondition(),this.updateBestScore(),this.summonEnemies(),this.cleanupObjects()}render(e,t){this.update(),this.updateBonuses(e),this.updateAndDraw(this.terrains,e,t),this.updateAndDraw(this.bonuses,e,t),this.updateAndDraw(this.enemies,e,t),this.updateAndDraw(this.collisions,e,t),this.updateAndDraw(this.player,e,t),this.updateAndDraw(this.UI,e,t)}restart(){this.gameOver=!1,this.maxEnemies=3,this.enemies=[],this.bonuses=[],this.score=0,this.wave=0,this.bonusTimer=0,this.bonusExpiredTimer=0,this.terrains=this.terrainsType.getRandomValue(),this.player.restart()}getRandomTerrain(){return this.terrainsType.getRandomValue()}getBestScore(){return localStorage.getItem("tankBestScore")||"0"}handleDebugMode(){this.input.keys.includes("p")&&(this.stroke=!this.stroke)}handleRestartGame(){(this.input.keys.includes("ArrowDown")||this.input.keys.includes("r"))&&this.gameOver&&this.restart()}handleLoseCondition(){this.player.lives<1&&(this.gameOver=!0)}updateBestScore(){var e,t;e="tankBestScore",(t=this.score)>parseInt(localStorage.getItem(e))&&localStorage.setItem(e,t.toString()),this.bestScore=this.getBestScore()}checkBestScore(){!function(e,t="0"){localStorage.getItem(e)||localStorage.setItem(e,t.toString())}("tankBestScore","0")}summonEnemies(){if(this.enemies.length<1&&!this.gameOver){for(let e=0;e<this.maxEnemies;e++)this.addEnemy();this.wave+=1,this.wave>1&&(this.terrains=this.getRandomTerrain()),this.maxEnemies+=1}}addEnemy(){this.enemies.push(new P(this))}updateBonuses(e){this.bonuses.length<1&&!this.gameOver&&(this.bonusExpiredTimer=0,this.handleBonusInterval(e)),this.bonuses.length>=1&&(this.bonusTimer=0,this.handleBonusExpiredTimer(e))}handleBonusInterval(e){this.bonusTimer>this.bonusInterval?(this.createBonus(),this.bonusTimer=0):this.bonusTimer+=e}createBonus(){const e=[new h(this),new i(this),new t(this),new r(this)].getRandomValue();this.bonuses.push(e)}handleBonusExpiredTimer(e){this.bonusExpiredTimer>this.bonusExpiredInterval?(this.bonuses=[],this.bonusExpiredTimer=0):this.bonusExpiredTimer+=e}cleanupObjects(){this.enemies=this.enemies.filter((e=>!e.markedForDeletion)),this.bonuses=this.bonuses.filter((e=>!e.markedForDeletion)),this.collisions=this.collisions.filter((e=>!e.markedForDeletion))}updateAndDraw(e,t,s){Array.isArray(e)?e.forEach((e=>{"function"==typeof e.update&&e.update(t),"function"==typeof e.draw&&e.draw(s)})):"object"==typeof e&&("function"==typeof e.update&&e.update(t),"function"==typeof e.draw&&e.draw(s))}createExplosion(e,t,s){this.collisions.push(new D(e,t,s))}checkCircleCollision(e,t){const s=e.x+.5*e.width,i=e.y+.5*e.height,h=s-(t.x+.5*t.width),r=i-(t.y+.5*t.width);return Math.sqrt(h*h+r*r)<.33*e.width+.33*t.width}checkCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}resolveCollision(e,t){const s=e.x+e.width/2-(t.x+t.width/2),i=e.y+e.height/2-(t.y+t.height/2),h=(Math.sqrt(s*s+i*i),Math.atan2(i,s)),r=Math.sqrt(e.speedX*e.speedX+e.speedY*e.speedY),a=r*Math.cos(h),o=r*Math.sin(h);e.speedX=a,e.speedY=o}bounceObject(e){const t=e,s=t.x,i=t.y;switch(t.direction){case"up":t.x=s,t.y=i+5;break;case"down":t.x=s,t.y=i-5;break;case"left":t.x=s+5,t.y=i;break;case"right":t.x=s-5,t.y=i}return t}}window.addEventListener("load",(function(){document.getElementById("loading-container").style.display="none";const e=document.getElementById("container");e.style.display="block";const t=e.getContext("2d");e.width=1280,e.height=1280;const s=new xe(e.width,e.height);let i=0;const h=r=>{const a=r-i;i=r,t.clearRect(0,0,e.width,e.height),s.render(a,t),requestAnimationFrame(h)};h(0)}))})()})();